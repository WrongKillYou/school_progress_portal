{% extends 'teacher_base.html' %}
{% load static %}

{% block title %}Teacher Dashboard{% endblock %}

{% block content %}
<div class="container-fluid">
  <h2 class="text-center mb-5">Welcome, {{ teacher.user.get_full_name }}</h2>

  <!-- Summary Cards -->
  <div class="row g-4 mb-5">
    <div class="col-md-6 col-xl-3">
      <div class="card shadow-sm text-center border-0 rounded-3">
        <div class="card-body">
          <h6 class="card-title text-primary fw-semibold">Handled Classes</h6>
          <p class="display-6 fw-bold mb-0">{{ total_classes }}</p>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-xl-3">
      <div class="card shadow-sm text-center border-0 rounded-3">
        <div class="card-body">
          <h6 class="card-title text-primary fw-semibold">Handled Students</h6>
          <p class="display-6 fw-bold mb-0">{{ total_students }}</p>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-xl-3">
      <div class="card shadow-sm text-center border-0 rounded-3">
        <div class="card-body">
          <h6 class="card-title text-primary fw-semibold">Announcements</h6>
          <p class="display-6 fw-bold mb-0">{{ total_announcements }}</p>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-xl-3">
      <div class="card shadow-sm text-center border-0 rounded-3">
        <div class="card-body">
          <h6 class="card-title text-primary fw-semibold">Merit Shards</h6>
          <p class="display-6 fw-bold mb-0">{{ total_merit }}</p>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-xl-3">
      <div class="card shadow-sm text-center border-0 rounded-3">
        <div class="card-body">
          <h6 class="card-title text-primary fw-semibold">Demerit Shards</h6>
          <p class="display-6 fw-bold mb-0">{{ total_demerit }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Class Day Toggle & Scan Attendance -->
  <div class="d-flex flex-column align-items-center gap-3">
    <button id="classDayBtn" 
            class="btn btn-outline-danger btn-lg rounded-pill px-5 py-3 shadow fw-bold">
      ðŸš« No Class Day
    </button>

    <a id="scanBtn" 
       href="{% url 'scan_attendance' %}" 
       class="btn btn-primary btn-lg rounded-pill px-5 py-4 shadow disabled" 
       aria-disabled="true">
      ðŸ“· Scan Attendance
    </a>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const btn = document.getElementById("classDayBtn");
  const scanBtn = document.getElementById("scanBtn");

  btn.addEventListener("click", function() {
    if (btn.classList.contains("btn-outline-danger")) {
      if (confirm("Mark today as a Class Day and start attendance for all your classes?")) {
        fetch("{% url 'start_class' %}", {
          method: "POST",
          headers: {
            "X-CSRFToken": "{{ csrf_token }}",
            "Content-Type": "application/json"
          }
        })
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            btn.textContent = "âœ… Class Day";
            btn.classList.remove("btn-outline-danger");
            btn.classList.add("btn-success");
            scanBtn.classList.remove("disabled");
            scanBtn.removeAttribute("aria-disabled");
            alert(data.message);
          } else {
            alert(data.message || "Error starting class day.");
          }
        })
        .catch(err => console.error(err));
      }
    }
  });
});
</script>
{% endblock %}
