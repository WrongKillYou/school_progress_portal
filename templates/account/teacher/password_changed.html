{% extends "teacher_base.html" %}
{% load static %}
{% block title %}Password Changed{% endblock %}

{% block content %}
<div class="container mt-4 d-flex flex-column align-items-center justify-content-center" style="min-height: 80vh;">
    <!-- SVG arrangement -->
    <div class="d-flex flex-column align-items-center mb-1 position-relative" style="width:100%;">
        <!-- Middle SVGs with animated 2.svg and 3.svg -->
        <div class="d-flex align-items-center justify-content-center" style="gap:.5rem;">
            <img src="{% static 'images/check.svg' %}" alt="Check" id="check-svg" style="width: 20rem; height: 20rem;">
        </div>
    </div>
    <h2 class="text-center">Password Changed Successfully!</h2>
    <p class="text-center">Your password has been updated.</p>
    <a href="{% url 'teacher_dashboard' %}" class="btn btn-success">Back to Dashboard</a>
</div>

<!-- Fullscreen confetti burst canvas -->
<canvas id="confetti-canvas" style="position:fixed;left:0;top:0;width:100vw;height:100vh;z-index:9999;pointer-events:none;"></canvas>

<script>
// Confetti parameters
const confettiColors = [
  '#FFC700', '#FF0000', '#2E3192', '#41BBC7', '#FF69B4', '#ad53f8', '#4CAF50', '#FF9800'
];
const confettiShapes = ['circle', 'rect', 'star', 'ribbon'];
let confetti = [];
const canvas = document.getElementById('confetti-canvas');
const ctx = canvas.getContext('2d');

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

function Confetto(originX, originY) {
  this.x = originX;
  this.y = originY;
  const angle = Math.random() * Math.PI * 2;
  const speed = 7 + Math.random() * 7;
  this.vx = Math.cos(angle) * speed;
  this.vy = Math.sin(angle) * speed - 2 - Math.random()*2;
  this.gravity = 0.22;
  this.rotation = Math.random() * Math.PI * 2;
  this.rotationSpeed = (Math.random()-0.5)*0.3;
  this.size = 10 + Math.random()*14;
  this.color = confettiColors[Math.floor(Math.random()*confettiColors.length)];
  this.shape = confettiShapes[Math.floor(Math.random()*confettiShapes.length)];
  this.opacity = 1;
}
Confetto.prototype.draw = function(ctx) {
  ctx.save();
  ctx.globalAlpha = this.opacity;
  ctx.translate(this.x, this.y);
  ctx.rotate(this.rotation);
  ctx.fillStyle = this.color;
  switch(this.shape) {
    case 'circle':
      ctx.beginPath();
      ctx.arc(0,0,this.size/2,0,2*Math.PI);
      ctx.fill();
      break;
    case 'rect':
      ctx.fillRect(-this.size/2,-this.size/2,this.size,this.size);
      break;
    case 'star':
      drawStar(ctx, 0, 0, 5, this.size/2, this.size/4);
      break;
    case 'ribbon':
      ctx.beginPath();
      ctx.moveTo(-this.size/2, 0);
      ctx.bezierCurveTo(-this.size/4, -this.size/1.6, this.size/4, this.size/1.6, this.size/2, 0);
      ctx.strokeStyle = this.color;
      ctx.lineWidth = 3;
      ctx.stroke();
      break;
  }
  ctx.restore();
};
function drawStar(ctx, x, y, points, outer, inner) {
  let angle = Math.PI / points;
  ctx.beginPath();
  for (let i = 0; i < 2 * points; i++) {
    let r = (i % 2 === 0) ? outer : inner;
    ctx.lineTo(Math.cos(i * angle) * r, Math.sin(i * angle) * r);
  }
  ctx.closePath();
  ctx.fill();
}

function burstConfettiFromElementCenter(element) {
  confetti = [];
  const rect = element.getBoundingClientRect();
  // Center of the element, relative to viewport
  const originX = rect.left + rect.width / 2;
  const originY = rect.top + rect.height / 2;
  for (let i = 0; i < 120; i++) {
    confetti.push(new Confetto(originX + (Math.random()-0.5)*40, originY + (Math.random()-0.5)*20));
  }
}
function animateConfetti() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for (let i=confetti.length-1; i>=0; i--) {
    const c = confetti[i];
    c.x += c.vx;
    c.y += c.vy;
    c.vy += c.gravity;
    c.rotation += c.rotationSpeed;
    c.opacity -= 0.009;
    c.draw(ctx);
    if (c.y > canvas.height+40 || c.x < -40 || c.x > canvas.width+40 || c.opacity <= 0) {
      confetti.splice(i,1);
    }
  }
  requestAnimationFrame(animateConfetti);
}
animateConfetti();

// Pop animation for SVGs
function popImage(img) {
  img.classList.remove('pop');
  void img.offsetWidth;
  img.classList.add('pop');
}

// Add pop animation CSS
(function addPopAnimCSS(){
  if (document.getElementById('pop-anim-style')) return;
  const style = document.createElement('style');
  style.id = 'pop-anim-style';
  style.textContent = `
    .popper-img {
      transition: transform 0.45s cubic-bezier(.17,.67,.83,.67);
      will-change: transform;
      user-select: none;
    }
    .popper-img.pop {
      animation: popper-pop 0.6s cubic-bezier(.32,1.22,.62,1.02);
    }
    @keyframes popper-pop {
      0%   { transform: scale(1) rotate(-5deg);}
      15%  { transform: scale(1.13) rotate(2deg);}
      40%  { transform: scale(0.96) rotate(-2deg);}
      65%  { transform: scale(1.10) rotate(3deg);}
      100% { transform: scale(1) rotate(0);}
    }
  `;
  document.head.appendChild(style);
})();

// On page load: pop 2.svg and 3.svg and burst confetti at check svg center
window.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.popper-img').forEach(popImage);
  const checkSvg = document.getElementById('check-svg');
  if(checkSvg) {
    burstConfettiFromElementCenter(checkSvg);
  }
});
</script>
{% endblock %}